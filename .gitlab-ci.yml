# Testing and Grading all tasks 
grade:
  image: eu.gcr.io/shad-ts/grader/py-testenv
  tags:
    - docker-tester-python
  except:
    variables:
      - $CI_MERGE_REQUEST_SOURCE_BRANCH_NAME =~ /contributing/
      - $CI_COMMIT_BRANCH =~ /contributing/
  script:
    - cd /opt/shad/tests
    - chmod -R 777 /opt/shad/tests
    - python3 grade.py grade
  timeout: 10 minutes

    
# Checking MR to main repo
check-mr:
  image: eu.gcr.io/shad-ts/grader/py-base-image
  tags:
    - docker-tester-python
  only:
    variables:
      - $CI_MERGE_REQUEST_SOURCE_BRANCH_NAME =~ /contributing/ || $CI_COMMIT_BRANCH =~ /contributing/
  script:
    - echo "CI_MERGE_REQUEST_SOURCE_PROJECT_PATH $CI_MERGE_REQUEST_SOURCE_PROJECT_PATH"
    - echo "CI_MERGE_REQUEST_SOURCE_PROJECT_URL $CI_MERGE_REQUEST_SOURCE_PROJECT_URL"
    - echo "CI_MERGE_REQUEST_TARGET_BRANCH_NAME $CI_MERGE_REQUEST_TARGET_BRANCH_NAME"
    - echo "CI_MERGE_REQUEST_TARGET_BRANCH_SHA $CI_MERGE_REQUEST_TARGET_BRANCH_SHA"
    - echo "CI_MERGE_REQUEST_TARGET_PROJECT_URL $CI_MERGE_REQUEST_TARGET_PROJECT_URL"
    - echo "CI_MERGE_REQUEST_REF_PATH $CI_MERGE_REQUEST_REF_PATH"
    - echo "CI_MERGE_REQUEST_PROJECT_URL $CI_MERGE_REQUEST_PROJECT_URL"
    - echo "CI_MERGE_REQUEST_PROJECT_PATH $CI_MERGE_REQUEST_PROJECT_PATH"
    - echo "CI_MERGE_REQUEST_PROJECT_ID $CI_MERGE_REQUEST_PROJECT_ID"
    - echo "CI_MERGE_REQUEST_LABELS $CI_MERGE_REQUEST_LABELS"
    - echo "CI_MERGE_REQUEST_APPROVED $CI_MERGE_REQUEST_APPROVED"
    - echo "CI_MERGE_REQUEST_EVENT_TYPE $CI_MERGE_REQUEST_EVENT_TYPE"
    - cd tests
    - ls -lah tests
    - python3 grade.py check
  timeout: 15 minutes
